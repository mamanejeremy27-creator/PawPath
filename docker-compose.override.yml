# Dev override — auto-applied by `docker compose up`.
# Swaps the backend production image for a dev server with hot reload.
# The frontend is meant to run natively: `cd frontend && pnpm run dev`

services:
  backend:
    build:
      target: builder      # stop at builder stage (has devDependencies for nest --watch)
    command: sh -c "npm install && npm run start:dev"
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: "true"   # needed for file-watch on macOS Docker volumes
    volumes:
      - ./backend:/app
      - backend_node_modules:/app/node_modules  # isolate container node_modules from host

  # Disable the frontend container in dev — run natively instead:
  #   cd frontend && pnpm run dev
  frontend:
    profiles:
      - prod

volumes:
  backend_node_modules:
