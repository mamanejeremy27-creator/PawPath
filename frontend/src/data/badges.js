export const BADGE_DEFS = [
  // ─── Streaks ───
  { id: "first_session", name: "First Steps", icon: "Footprints", desc: "Complete your first training session", category: "streaks" },
  { id: "streak_3", name: "On a Roll", icon: "Flame", desc: "3-day training streak", category: "streaks" },
  { id: "streak_7", name: "Dedicated", icon: "Star", desc: "7-day training streak", category: "streaks" },
  { id: "streak_14", name: "Unstoppable", icon: "Trophy", desc: "14-day training streak", category: "streaks" },
  { id: "streak_30", name: "Legendary", icon: "Crown", desc: "30-day training streak", category: "streaks" },
  { id: "streak_60", name: "Iron Will", icon: "Shield", desc: "60-day training streak", category: "streaks" },
  { id: "streak_90", name: "Marathon Trainer", icon: "Medal", desc: "90-day training streak", category: "streaks" },
  { id: "streak_365", name: "Year-Round", icon: "Sparkles", desc: "365-day training streak", category: "streaks" },

  // ─── Training ───
  { id: "exercises_5", name: "Getting Started", icon: "Sprout", desc: "Complete 5 exercises", category: "training" },
  { id: "exercises_25", name: "Progressing", icon: "TrendingUp", desc: "Complete 25 exercises", category: "training" },
  { id: "exercises_50", name: "Halfway Hero", icon: "Target", desc: "Complete 50 exercises", category: "training" },
  { id: "exercises_100", name: "Century Club", icon: "CheckCircle2", desc: "Complete 100 exercises", category: "training" },
  { id: "level_complete", name: "Level Up", icon: "Target", desc: "Complete your first level", category: "training" },
  { id: "level_5", name: "Rising Star", icon: "Star", desc: "Reach Level 5", category: "training" },
  { id: "level_10", name: "Top Dog", icon: "PawPrint", desc: "Reach Level 10", category: "training" },
  { id: "xp_500", name: "XP Hunter", icon: "Zap", desc: "Earn 500 XP", category: "training" },
  { id: "xp_1000", name: "Power Player", icon: "Rocket", desc: "Earn 1,000 XP", category: "training" },
  { id: "xp_2500", name: "XP Collector", icon: "Coins", desc: "Earn 2,500 XP", category: "training" },
  { id: "xp_5000", name: "XP Machine", icon: "Bot", desc: "Earn 5,000 XP", category: "training" },
  { id: "xp_10000", name: "XP Legend", icon: "Crown", desc: "Earn 10,000 XP", category: "training" },
  { id: "sessions_10", name: "Routine Builder", icon: "Calendar", desc: "10 training sessions", category: "training" },
  { id: "quick_learner", name: "Quick Learner", icon: "Brain", desc: "3 exercises in one day", category: "training" },

  // ─── Programs ───
  { id: "prog_foundations", name: "Foundation Builder", icon: "Landmark", desc: "Complete Puppy Foundations", category: "programs" },
  { id: "prog_potty", name: "House Trained", icon: "Home", desc: "Complete Potty Training", category: "programs" },
  { id: "prog_crate", name: "Crate Champ", icon: "House", desc: "Complete Crate Training", category: "programs" },
  { id: "prog_social", name: "Social Butterfly", icon: "Handshake", desc: "Complete Puppy Socialization", category: "programs" },
  { id: "prog_behavior", name: "Problem Solver", icon: "Puzzle", desc: "Complete Behavior Solutions", category: "programs" },
  { id: "prog_obedience", name: "Good Citizen", icon: "GraduationCap", desc: "Complete Core Obedience", category: "programs" },
  { id: "prog_tricks", name: "Trick Star", icon: "Wand2", desc: "Complete Trick Training", category: "programs" },
  { id: "prog_reactivity", name: "Leash Pro", icon: "Zap", desc: "Complete Leash Reactivity", category: "programs" },
  { id: "prog_fitness", name: "Athlete", icon: "Dumbbell", desc: "Complete Canine Fitness", category: "programs" },

  // ─── Journal ───
  { id: "journal_5", name: "Reflective", icon: "PenLine", desc: "Write 5 journal entries", category: "journal" },
  { id: "journal_20", name: "Chronicler", icon: "BookOpen", desc: "Write 20 journal entries", category: "journal" },
  { id: "journal_50", name: "Storyteller", icon: "Pen", desc: "Write 50 journal entries", category: "journal" },
  { id: "first_photo", name: "First Snapshot", icon: "Camera", desc: "Take first photo", category: "journal" },
  { id: "photos_10", name: "Photo Album", icon: "Image", desc: "10 photos saved", category: "journal" },
  { id: "photos_25", name: "Memory Keeper", icon: "Camera", desc: "25 photos saved", category: "journal" },

  // ─── Skills ───
  { id: "caretaker", name: "Caretaker", icon: "Leaf", desc: "Review 10 exercises", category: "skills" },
  { id: "maintenance_master", name: "Maintenance Master", icon: "Gem", desc: "Keep all skills fresh for 7 days", category: "skills" },
  { id: "skill_guardian", name: "Skill Guardian", icon: "Landmark", desc: "Keep all skills fresh for 30 days", category: "skills" },

  // ─── Special ───
  { id: "double_trouble", name: "Double Trouble", icon: "PawPrint", desc: "Add a second dog", category: "special" },
  { id: "pack_leader", name: "Pack Leader", icon: "PawPrint", desc: "Train both dogs in the same day", category: "special" },

  // ─── Challenge ───
  { id: "challenge-recall-master", name: "Recall Master", icon: "Megaphone", desc: "Completed Recall Master Week", category: "challenge" },
  { id: "challenge-patience-guru", name: "Patience Guru", icon: "Timer", desc: "Completed Patience & Impulse Control Week", category: "challenge" },
  { id: "challenge-trick-star", name: "Trick Star", icon: "Wand2", desc: "Completed Trick Star Week", category: "challenge" },
  { id: "challenge-leash-pro", name: "Leash Pro", icon: "PawPrint", desc: "Completed Loose Leash Week", category: "challenge" },
  { id: "challenge-puppy-grad", name: "Puppy Graduate", icon: "PawPrint", desc: "Completed Puppy Bootcamp", category: "challenge" },
  { id: "challenge-social-butterfly", name: "Social Butterfly", icon: "Users", desc: "Completed Socialization Sprint", category: "challenge" },
  { id: "challenge-fitness-champ", name: "Fitness Champ", icon: "Dumbbell", desc: "Completed Canine Fitness Week", category: "challenge" },
  { id: "challenge-crate-lover", name: "Crate Lover", icon: "House", desc: "Completed Crate Comfort Week", category: "challenge" },
  { id: "challenge-behavior-boss", name: "Behavior Boss", icon: "Puzzle", desc: "Completed Behavior Fix Week", category: "challenge" },
  { id: "challenge-potty-pro", name: "Potty Pro", icon: "Droplets", desc: "Completed Potty Pro Week", category: "challenge" },
  { id: "challenge-laser-focus", name: "Laser Focus", icon: "Crosshair", desc: "Completed Focus & Attention Week", category: "challenge" },
  { id: "challenge-adventurer", name: "Adventurer", icon: "Globe", desc: "Completed Adventure Week", category: "challenge" },
  // ─── Streak Rewards ───
  { id: "streak-3-days", name: "3-Day Spark", icon: "Sparkles", desc: "3-day training streak", category: "streak" },
  { id: "streak-7-days", name: "Week Warrior", icon: "Waves", desc: "7-day training streak", category: "streak" },
  { id: "streak-14-days", name: "2-Week Warrior", icon: "Swords", desc: "14-day training streak", category: "streak" },
  { id: "streak-30-days", name: "Monthly Master", icon: "Crown", desc: "30-day training streak", category: "streak" },
  { id: "streak-60-days", name: "Unstoppable", icon: "ShieldCheck", desc: "60-day training streak", category: "streak" },
  { id: "streak-90-days", name: "Quarter Champion", icon: "Moon", desc: "90-day training streak", category: "streak" },
  { id: "streak-180-days", name: "Half-Year Hero", icon: "Rainbow", desc: "180-day training streak", category: "streak" },
  { id: "streak-365-days", name: "Legendary Trainer", icon: "Trophy", desc: "365-day training streak", category: "streak" },
  { id: "streak-recovered", name: "Comeback Kid", icon: "Dumbbell", desc: "Recovered a broken streak", category: "streak" },
  { id: "streak-freeze-used", name: "Ice Save", icon: "Snowflake", desc: "Used a streak freeze to save your streak", category: "streak" },

  // Challenge meta badges
  { id: "challenge-first-complete", name: "First Challenge!", icon: "Trophy", desc: "Completed your first weekly challenge", category: "challenge" },
  { id: "challenge-5-complete", name: "Challenge Veteran", icon: "Star", desc: "Completed 5 weekly challenges", category: "challenge" },
  { id: "challenge-streak-3", name: "3 Weeks Strong", icon: "Flame", desc: "Completed 3 challenges in a row", category: "challenge" },
  { id: "challenge-partial-hero", name: "Almost There!", icon: "Dumbbell", desc: "Completed 5+ days of a challenge", category: "challenge" },
];

function isProgramComplete(progId, state) {
  if (!state.programs) return false;
  const prog = state.programs.find(p => p.id === progId);
  if (!prog) return false;
  return prog.levels.every(l => l.exercises.every(e => state.completedExercises.includes(e.id)));
}

export function checkBadgeCondition(badgeId, state) {
  switch (badgeId) {
    // Streaks
    case "first_session": return state.totalSessions >= 1;
    case "streak_3": return state.currentStreak >= 3;
    case "streak_7": return state.currentStreak >= 7;
    case "streak_14": return state.currentStreak >= 14;
    case "streak_30": return state.currentStreak >= 30;
    case "streak_60": return state.currentStreak >= 60;
    case "streak_90": return state.currentStreak >= 90;
    case "streak_365": return state.currentStreak >= 365;
    // Training - exercises
    case "exercises_5": return state.completedExercises.length >= 5;
    case "exercises_25": return state.completedExercises.length >= 25;
    case "exercises_50": return state.completedExercises.length >= 50;
    case "exercises_100": return state.completedExercises.length >= 100;
    // Training - levels & XP
    case "level_complete": return state.completedLevels.length >= 1;
    case "level_5": return (state.playerLevel || 1) >= 5;
    case "level_10": return (state.playerLevel || 1) >= 10;
    case "xp_500": return state.totalXP >= 500;
    case "xp_1000": return state.totalXP >= 1000;
    case "xp_2500": return state.totalXP >= 2500;
    case "xp_5000": return state.totalXP >= 5000;
    case "xp_10000": return state.totalXP >= 10000;
    // Training - sessions
    case "sessions_10": return state.totalSessions >= 10;
    case "quick_learner": return state.todayExercises >= 3;
    // Programs
    case "prog_foundations": return isProgramComplete("foundations", state);
    case "prog_potty": return isProgramComplete("potty", state);
    case "prog_crate": return isProgramComplete("crate", state);
    case "prog_social": return isProgramComplete("social", state);
    case "prog_behavior": return isProgramComplete("behavior", state);
    case "prog_obedience": return isProgramComplete("obedience", state);
    case "prog_tricks": return isProgramComplete("tricks", state);
    case "prog_reactivity": return isProgramComplete("reactivity", state);
    case "prog_fitness": return isProgramComplete("fitness", state);
    // Journal
    case "journal_5": return state.journal.length >= 5;
    case "journal_20": return state.journal.length >= 20;
    case "journal_50": return state.journal.length >= 50;
    case "first_photo": return (state.photoCount || 0) >= 1;
    case "photos_10": return (state.photoCount || 0) >= 10;
    case "photos_25": return (state.photoCount || 0) >= 25;
    // Skills
    case "caretaker": return (state.totalReviews || 0) >= 10;
    case "maintenance_master": return state.allSkillsFresh && state.completedExercises.length >= 5;
    case "skill_guardian": return state.allSkillsFresh && (state.totalReviews || 0) >= 30;
    // Special
    case "double_trouble": return (state.dogCount || 1) >= 2;
    case "pack_leader": return state.bothDogsTrainedToday === true;
    // Streak rewards
    case "streak-3-days": return (state.streakBest || state.currentStreak) >= 3;
    case "streak-7-days": return (state.streakBest || state.currentStreak) >= 7;
    case "streak-14-days": return (state.streakBest || state.currentStreak) >= 14;
    case "streak-30-days": return (state.streakBest || state.currentStreak) >= 30;
    case "streak-60-days": return (state.streakBest || state.currentStreak) >= 60;
    case "streak-90-days": return (state.streakBest || state.currentStreak) >= 90;
    case "streak-180-days": return (state.streakBest || state.currentStreak) >= 180;
    case "streak-365-days": return (state.streakBest || state.currentStreak) >= 365;
    case "streak-recovered": return state.streakRecovered === true;
    case "streak-freeze-used": return (state.streakFreezesUsed || 0) >= 1;
    // Challenge — per-challenge badges (7/7 days completed)
    case "challenge-recall-master":
    case "challenge-patience-guru":
    case "challenge-trick-star":
    case "challenge-leash-pro":
    case "challenge-puppy-grad":
    case "challenge-social-butterfly":
    case "challenge-fitness-champ":
    case "challenge-crate-lover":
    case "challenge-behavior-boss":
    case "challenge-potty-pro":
    case "challenge-laser-focus":
    case "challenge-adventurer": {
      const ch = state.challengeHistory || [];
      return ch.some(h => h.badgeEarned === badgeId && h.fullComplete);
    }
    // Challenge meta badges
    case "challenge-first-complete": return (state.challengeStats?.totalCompleted || 0) >= 1;
    case "challenge-5-complete": return (state.challengeStats?.totalCompleted || 0) >= 5;
    case "challenge-streak-3": return (state.challengeStats?.bestStreak || 0) >= 3;
    case "challenge-partial-hero": {
      const ch2 = state.challengeHistory || [];
      return ch2.some(h => h.completedDays.length >= 5);
    }
    default: return false;
  }
}
