export const BADGE_DEFS = [
  // ─── Streaks ───
  { id: "first_session", name: "First Steps", emoji: "\uD83D\uDC63", desc: "Complete your first training session", category: "streaks" },
  { id: "streak_3", name: "On a Roll", emoji: "\uD83D\uDD25", desc: "3-day training streak", category: "streaks" },
  { id: "streak_7", name: "Dedicated", emoji: "\u2B50", desc: "7-day training streak", category: "streaks" },
  { id: "streak_14", name: "Unstoppable", emoji: "\uD83C\uDFC6", desc: "14-day training streak", category: "streaks" },
  { id: "streak_30", name: "Legendary", emoji: "\uD83D\uDC51", desc: "30-day training streak", category: "streaks" },
  { id: "streak_60", name: "Iron Will", emoji: "\uD83E\uDDBE", desc: "60-day training streak", category: "streaks" },
  { id: "streak_90", name: "Marathon Trainer", emoji: "\uD83C\uDFC5", desc: "90-day training streak", category: "streaks" },
  { id: "streak_365", name: "Year-Round", emoji: "\uD83C\uDF1F", desc: "365-day training streak", category: "streaks" },

  // ─── Training ───
  { id: "exercises_5", name: "Getting Started", emoji: "\uD83C\uDF31", desc: "Complete 5 exercises", category: "training" },
  { id: "exercises_25", name: "Progressing", emoji: "\uD83D\uDCC8", desc: "Complete 25 exercises", category: "training" },
  { id: "exercises_50", name: "Halfway Hero", emoji: "\uD83C\uDFAF", desc: "Complete 50 exercises", category: "training" },
  { id: "exercises_100", name: "Century Club", emoji: "\uD83D\uDCAF", desc: "Complete 100 exercises", category: "training" },
  { id: "level_complete", name: "Level Up", emoji: "\uD83C\uDFAF", desc: "Complete your first level", category: "training" },
  { id: "level_5", name: "Rising Star", emoji: "\u2B50", desc: "Reach Level 5", category: "training" },
  { id: "level_10", name: "Top Dog", emoji: "\uD83D\uDC15\u200D\uD83E\uDDBA", desc: "Reach Level 10", category: "training" },
  { id: "xp_500", name: "XP Hunter", emoji: "\u26A1", desc: "Earn 500 XP", category: "training" },
  { id: "xp_1000", name: "Power Player", emoji: "\uD83D\uDE80", desc: "Earn 1,000 XP", category: "training" },
  { id: "xp_2500", name: "XP Collector", emoji: "\uD83D\uDCB0", desc: "Earn 2,500 XP", category: "training" },
  { id: "xp_5000", name: "XP Machine", emoji: "\uD83E\uDD16", desc: "Earn 5,000 XP", category: "training" },
  { id: "xp_10000", name: "XP Legend", emoji: "\uD83D\uDC51", desc: "Earn 10,000 XP", category: "training" },
  { id: "sessions_10", name: "Routine Builder", emoji: "\uD83D\uDCC5", desc: "10 training sessions", category: "training" },
  { id: "quick_learner", name: "Quick Learner", emoji: "\uD83E\uDDE0", desc: "3 exercises in one day", category: "training" },

  // ─── Programs ───
  { id: "prog_foundations", name: "Foundation Builder", emoji: "\uD83E\uDDF1", desc: "Complete Puppy Foundations", category: "programs" },
  { id: "prog_potty", name: "House Trained", emoji: "\uD83C\uDFE1", desc: "Complete Potty Training", category: "programs" },
  { id: "prog_crate", name: "Crate Champ", emoji: "\uD83C\uDFE0", desc: "Complete Crate Training", category: "programs" },
  { id: "prog_social", name: "Social Butterfly", emoji: "\uD83E\uDD1D", desc: "Complete Puppy Socialization", category: "programs" },
  { id: "prog_behavior", name: "Problem Solver", emoji: "\uD83E\uDDE9", desc: "Complete Behavior Solutions", category: "programs" },
  { id: "prog_obedience", name: "Good Citizen", emoji: "\uD83C\uDF96\uFE0F", desc: "Complete Core Obedience", category: "programs" },
  { id: "prog_tricks", name: "Trick Star", emoji: "\uD83C\uDFAA", desc: "Complete Trick Training", category: "programs" },
  { id: "prog_reactivity", name: "Leash Pro", emoji: "\uD83E\uDDAE", desc: "Complete Leash Reactivity", category: "programs" },
  { id: "prog_fitness", name: "Athlete", emoji: "\uD83D\uDCAA", desc: "Complete Canine Fitness", category: "programs" },

  // ─── Journal ───
  { id: "journal_5", name: "Reflective", emoji: "\uD83D\uDCDD", desc: "Write 5 journal entries", category: "journal" },
  { id: "journal_20", name: "Chronicler", emoji: "\uD83D\uDCD6", desc: "Write 20 journal entries", category: "journal" },
  { id: "journal_50", name: "Storyteller", emoji: "\u270D\uFE0F", desc: "Write 50 journal entries", category: "journal" },
  { id: "first_photo", name: "First Snapshot", emoji: "\uD83D\uDCF8", desc: "Take first photo", category: "journal" },
  { id: "photos_10", name: "Photo Album", emoji: "\uD83D\uDDBC\uFE0F", desc: "10 photos saved", category: "journal" },
  { id: "photos_25", name: "Memory Keeper", emoji: "\uD83D\uDCF7", desc: "25 photos saved", category: "journal" },

  // ─── Skills ───
  { id: "caretaker", name: "Caretaker", emoji: "\uD83C\uDF3F", desc: "Review 10 exercises", category: "skills" },
  { id: "maintenance_master", name: "Maintenance Master", emoji: "\uD83D\uDC8E", desc: "Keep all skills fresh for 7 days", category: "skills" },
  { id: "skill_guardian", name: "Skill Guardian", emoji: "\uD83C\uDFF0", desc: "Keep all skills fresh for 30 days", category: "skills" },

  // ─── Special ───
  { id: "double_trouble", name: "Double Trouble", emoji: "\uD83D\uDC36\uD83D\uDC36", desc: "Add a second dog", category: "special" },
  { id: "pack_leader", name: "Pack Leader", emoji: "\uD83D\uDC3A", desc: "Train both dogs in the same day", category: "special" },

  // ─── Challenge ───
  { id: "challenge-recall-master", name: "Recall Master", emoji: "\uD83D\uDCE3", desc: "Completed Recall Master Week", category: "challenge" },
  { id: "challenge-patience-guru", name: "Patience Guru", emoji: "\uD83E\uDDD8", desc: "Completed Patience & Impulse Control Week", category: "challenge" },
  { id: "challenge-trick-star", name: "Trick Star", emoji: "\uD83C\uDFAA", desc: "Completed Trick Star Week", category: "challenge" },
  { id: "challenge-leash-pro", name: "Leash Pro", emoji: "\uD83E\uDDAE", desc: "Completed Loose Leash Week", category: "challenge" },
  { id: "challenge-puppy-grad", name: "Puppy Graduate", emoji: "\uD83D\uDC36", desc: "Completed Puppy Bootcamp", category: "challenge" },
  { id: "challenge-social-butterfly", name: "Social Butterfly", emoji: "\uD83D\uDC15\u200D\uD83E\uDDBA", desc: "Completed Socialization Sprint", category: "challenge" },
  { id: "challenge-fitness-champ", name: "Fitness Champ", emoji: "\uD83C\uDFCB\uFE0F", desc: "Completed Canine Fitness Week", category: "challenge" },
  { id: "challenge-crate-lover", name: "Crate Lover", emoji: "\uD83C\uDFE0", desc: "Completed Crate Comfort Week", category: "challenge" },
  { id: "challenge-behavior-boss", name: "Behavior Boss", emoji: "\uD83E\uDDE9", desc: "Completed Behavior Fix Week", category: "challenge" },
  { id: "challenge-potty-pro", name: "Potty Pro", emoji: "\uD83D\uDEBD", desc: "Completed Potty Pro Week", category: "challenge" },
  { id: "challenge-laser-focus", name: "Laser Focus", emoji: "\uD83C\uDFAF", desc: "Completed Focus & Attention Week", category: "challenge" },
  { id: "challenge-adventurer", name: "Adventurer", emoji: "\uD83C\uDF0D", desc: "Completed Adventure Week", category: "challenge" },
  // Challenge meta badges
  { id: "challenge-first-complete", name: "First Challenge!", emoji: "\uD83C\uDFC6", desc: "Completed your first weekly challenge", category: "challenge" },
  { id: "challenge-5-complete", name: "Challenge Veteran", emoji: "\u2B50", desc: "Completed 5 weekly challenges", category: "challenge" },
  { id: "challenge-streak-3", name: "3 Weeks Strong", emoji: "\uD83D\uDD25", desc: "Completed 3 challenges in a row", category: "challenge" },
  { id: "challenge-partial-hero", name: "Almost There!", emoji: "\uD83D\uDCAA", desc: "Completed 5+ days of a challenge", category: "challenge" },
];

function isProgramComplete(progId, state) {
  if (!state.programs) return false;
  const prog = state.programs.find(p => p.id === progId);
  if (!prog) return false;
  return prog.levels.every(l => l.exercises.every(e => state.completedExercises.includes(e.id)));
}

export function checkBadgeCondition(badgeId, state) {
  switch (badgeId) {
    // Streaks
    case "first_session": return state.totalSessions >= 1;
    case "streak_3": return state.currentStreak >= 3;
    case "streak_7": return state.currentStreak >= 7;
    case "streak_14": return state.currentStreak >= 14;
    case "streak_30": return state.currentStreak >= 30;
    case "streak_60": return state.currentStreak >= 60;
    case "streak_90": return state.currentStreak >= 90;
    case "streak_365": return state.currentStreak >= 365;
    // Training - exercises
    case "exercises_5": return state.completedExercises.length >= 5;
    case "exercises_25": return state.completedExercises.length >= 25;
    case "exercises_50": return state.completedExercises.length >= 50;
    case "exercises_100": return state.completedExercises.length >= 100;
    // Training - levels & XP
    case "level_complete": return state.completedLevels.length >= 1;
    case "level_5": return (state.playerLevel || 1) >= 5;
    case "level_10": return (state.playerLevel || 1) >= 10;
    case "xp_500": return state.totalXP >= 500;
    case "xp_1000": return state.totalXP >= 1000;
    case "xp_2500": return state.totalXP >= 2500;
    case "xp_5000": return state.totalXP >= 5000;
    case "xp_10000": return state.totalXP >= 10000;
    // Training - sessions
    case "sessions_10": return state.totalSessions >= 10;
    case "quick_learner": return state.todayExercises >= 3;
    // Programs
    case "prog_foundations": return isProgramComplete("foundations", state);
    case "prog_potty": return isProgramComplete("potty", state);
    case "prog_crate": return isProgramComplete("crate", state);
    case "prog_social": return isProgramComplete("social", state);
    case "prog_behavior": return isProgramComplete("behavior", state);
    case "prog_obedience": return isProgramComplete("obedience", state);
    case "prog_tricks": return isProgramComplete("tricks", state);
    case "prog_reactivity": return isProgramComplete("reactivity", state);
    case "prog_fitness": return isProgramComplete("fitness", state);
    // Journal
    case "journal_5": return state.journal.length >= 5;
    case "journal_20": return state.journal.length >= 20;
    case "journal_50": return state.journal.length >= 50;
    case "first_photo": return (state.photoCount || 0) >= 1;
    case "photos_10": return (state.photoCount || 0) >= 10;
    case "photos_25": return (state.photoCount || 0) >= 25;
    // Skills
    case "caretaker": return (state.totalReviews || 0) >= 10;
    case "maintenance_master": return state.allSkillsFresh && state.completedExercises.length >= 5;
    case "skill_guardian": return state.allSkillsFresh && (state.totalReviews || 0) >= 30;
    // Special
    case "double_trouble": return (state.dogCount || 1) >= 2;
    case "pack_leader": return state.bothDogsTrainedToday === true;
    // Challenge — per-challenge badges (7/7 days completed)
    case "challenge-recall-master":
    case "challenge-patience-guru":
    case "challenge-trick-star":
    case "challenge-leash-pro":
    case "challenge-puppy-grad":
    case "challenge-social-butterfly":
    case "challenge-fitness-champ":
    case "challenge-crate-lover":
    case "challenge-behavior-boss":
    case "challenge-potty-pro":
    case "challenge-laser-focus":
    case "challenge-adventurer": {
      const ch = state.challengeHistory || [];
      return ch.some(h => h.badgeEarned === badgeId && h.fullComplete);
    }
    // Challenge meta badges
    case "challenge-first-complete": return (state.challengeStats?.totalCompleted || 0) >= 1;
    case "challenge-5-complete": return (state.challengeStats?.totalCompleted || 0) >= 5;
    case "challenge-streak-3": return (state.challengeStats?.bestStreak || 0) >= 3;
    case "challenge-partial-hero": {
      const ch2 = state.challengeHistory || [];
      return ch2.some(h => h.completedDays.length >= 5);
    }
    default: return false;
  }
}
